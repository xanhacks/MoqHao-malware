#!/usr/bin/env python3
from sys import argv, exit as sys_exit
from zlib import decompress


def unpack(path):
    """Unpack resource of MoqHao malware."""
    with open(path, "rb") as resource, open(path + ".dex", "wb") as dex:
        data = resource.read()

        size = data[10] | data[9] << 8 | data[8] << 16
        xor_key = data[11]

        dec = bytes(data[12 + i] ^ xor_key for i in range(size))

        dex.write(decompress(dec))
        print("[*] Unpacked at '" + path + ".dex'.")


if __name__ == "__main__":
    if len(argv) != 2:
        print("[!] Usage : " + argv[0] + " <resource>")
        sys_exit(1)
    
    unpack(argv[1])

