#!/usr/bin/env python3
from sys import argv, exit as sys_exit
from base64 import urlsafe_b64decode

from Crypto.Cipher import DES


KEY = b"Ab5d1Q32"
IV = KEY


def decrypt(ciphertext):
    """Decrypt MoqHao C2 URI."""
    for group in ["ffgtrrt", "bgfrewi", "htynff", "gfjytg", "dseregn"]:
        ciphertext = ciphertext.replace(group, "")

    data = urlsafe_b64decode(ciphertext + "==")
    cipher = DES.new(KEY, DES.MODE_CBC, iv=IV)
    return cipher.decrypt(data)


if __name__ == "__main__":
    if len(argv) != 2:
        print("[!] Usage : " + argv[0] + " <ciphertext>")
        sys_exit(1)

    cleartext = decrypt(argv[1])
    print(b"[*] Cleartext : " + cleartext)
